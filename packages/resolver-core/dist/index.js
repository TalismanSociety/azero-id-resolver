"use strict";var se=Object.create;var _=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var oe=Object.getOwnPropertyNames;var ie=Object.getPrototypeOf,de=Object.prototype.hasOwnProperty;var pe=(e,a)=>()=>(a||e((a={exports:{}}).exports,a),a.exports),le=(e,a)=>{for(var t in a)_(e,t,{get:a[t],enumerable:!0})},H=(e,a,t,r)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of oe(a))!de.call(e,n)&&n!==t&&_(e,n,{get:()=>a[n],enumerable:!(r=ne(a,n))||r.enumerable});return e};var A=(e,a,t)=>(t=e!=null?se(ie(e)):{},H(a||!e||!e.__esModule?_(t,"default",{value:e,enumerable:!0}):t,e)),me=e=>H(_({},"__esModule",{value:!0}),e);var F=pe((be,ue)=>{ue.exports={source:{hash:"0x63308c1311af44bb47082327c301fce559ca28f6bb010a61b9884d9246746abf",language:"ink! 4.2.1",compiler:"rustc 1.68.0-nightly",build_info:{build_mode:"Release",cargo_contract_version:"3.0.1",rust_toolchain:"nightly-aarch64-apple-darwin",wasm_opt_settings:{keep_debug_symbols:!1,optimization_passes:"Z"}}},contract:{name:"azns_router",version:"1.0.0",authors:["AZERO.ID <hello@azero.id>"]},spec:{constructors:[{args:[{label:"admin",type:{displayName:["AccountId"],type:0}}],default:!1,docs:[],label:"new",payable:!1,returnType:{displayName:["ink_primitives","ConstructorResult"],type:6},selector:"0x9bae9d5e"}],docs:[],environment:{accountId:{displayName:["AccountId"],type:0},balance:{displayName:["Balance"],type:25},blockNumber:{displayName:["BlockNumber"],type:28},chainExtension:{displayName:["ChainExtension"],type:29},hash:{displayName:["Hash"],type:26},maxEventTopics:4,timestamp:{displayName:["Timestamp"],type:27}},events:[],lang_error:{displayName:["ink","LangError"],type:8},messages:[{args:[{label:"tld",type:{displayName:["Vec"],type:4}},{label:"registry_addr",type:{displayName:["AccountId"],type:0}}],default:!1,docs:[],label:"add_registry",mutates:!0,payable:!1,returnType:{displayName:["ink","MessageResult"],type:9},selector:"0xc997efe3"},{args:[{label:"tld",type:{displayName:["Vec"],type:4}},{label:"registry_addr",type:{displayName:["AccountId"],type:0}}],default:!1,docs:[],label:"update_registry",mutates:!0,payable:!1,returnType:{displayName:["ink","MessageResult"],type:9},selector:"0x562de86b"},{args:[{label:"registry_addr",type:{displayName:["AccountId"],type:0}}],default:!1,docs:[],label:"remove_registry_address",mutates:!0,payable:!1,returnType:{displayName:["ink","MessageResult"],type:9},selector:"0xcc78aead"},{args:[],default:!1,docs:[],label:"get_all_registries",mutates:!1,payable:!1,returnType:{displayName:["ink","MessageResult"],type:12},selector:"0xe6da7bf0"},{args:[],default:!1,docs:[],label:"get_all_tlds",mutates:!1,payable:!1,returnType:{displayName:["ink","MessageResult"],type:15},selector:"0xf1a7af41"},{args:[{label:"registry_addr",type:{displayName:["AccountId"],type:0}}],default:!1,docs:[],label:"get_associated_tlds",mutates:!1,payable:!1,returnType:{displayName:["ink","MessageResult"],type:15},selector:"0xcb18f821"},{args:[{label:"tld",type:{displayName:["String"],type:5}}],default:!1,docs:[],label:"get_registry",mutates:!1,payable:!1,returnType:{displayName:["ink","MessageResult"],type:16},selector:"0x15a5d20a"},{args:[{label:"domain",type:{displayName:["String"],type:5}}],default:!1,docs:[],label:"get_address",mutates:!1,payable:!1,returnType:{displayName:["ink","MessageResult"],type:18},selector:"0xd259f7ba"},{args:[{label:"account",type:{displayName:["AccountId"],type:0}},{label:"tld",type:{displayName:["Option"],type:20}}],default:!1,docs:[" @returns list of (registry-address, primary-domain) for given account"],label:"get_primary_domains",mutates:!1,payable:!1,returnType:{displayName:["ink","MessageResult"],type:21},selector:"0xdf3a358e"},{args:[],default:!1,docs:[],label:"get_admin",mutates:!1,payable:!1,returnType:{displayName:["ink","MessageResult"],type:24},selector:"0x57b8a8a7"},{args:[],default:!1,docs:[],label:"get_pending_admin",mutates:!1,payable:!1,returnType:{displayName:["ink","MessageResult"],type:16},selector:"0xbcd31d76"},{args:[{label:"account",type:{displayName:["Option"],type:17}}],default:!1,docs:[],label:"transfer_ownership",mutates:!0,payable:!1,returnType:{displayName:["ink","MessageResult"],type:9},selector:"0x107e33ea"},{args:[],default:!1,docs:[],label:"accept_ownership",mutates:!0,payable:!1,returnType:{displayName:["ink","MessageResult"],type:9},selector:"0xb55be9f0"},{args:[{label:"code_hash",type:{displayName:[],type:1}}],default:!1,docs:[],label:"upgrade_contract",mutates:!0,payable:!1,returnType:{displayName:["ink","MessageResult"],type:6},selector:"0x1345543d"}]},storage:{root:{layout:{struct:{fields:[{layout:{leaf:{key:"0x00000000",ty:0}},name:"admin"},{layout:{enum:{dispatchKey:"0x00000000",name:"Option",variants:{"0":{fields:[],name:"None"},"1":{fields:[{layout:{leaf:{key:"0x00000000",ty:0}},name:"0"}],name:"Some"}}}},name:"pending_admin"},{layout:{leaf:{key:"0x00000000",ty:3}},name:"registry"},{layout:{root:{layout:{leaf:{key:"0x00000064",ty:0}},root_key:"0x00000064"}},name:"routes"},{layout:{root:{layout:{leaf:{key:"0x00000065",ty:4}},root_key:"0x00000065"}},name:"associated_tlds"}],name:"Router"}},root_key:"0x00000000"}},types:[{id:0,type:{def:{composite:{fields:[{type:1,typeName:"[u8; 32]"}]}},path:["ink_primitives","types","AccountId"]}},{id:1,type:{def:{array:{len:32,type:2}}}},{id:2,type:{def:{primitive:"u8"}}},{id:3,type:{def:{sequence:{type:0}}}},{id:4,type:{def:{sequence:{type:5}}}},{id:5,type:{def:{primitive:"str"}}},{id:6,type:{def:{variant:{variants:[{fields:[{type:7}],index:0,name:"Ok"},{fields:[{type:8}],index:1,name:"Err"}]}},params:[{name:"T",type:7},{name:"E",type:8}],path:["Result"]}},{id:7,type:{def:{tuple:[]}}},{id:8,type:{def:{variant:{variants:[{index:1,name:"CouldNotReadInput"}]}},path:["ink_primitives","LangError"]}},{id:9,type:{def:{variant:{variants:[{fields:[{type:10}],index:0,name:"Ok"},{fields:[{type:8}],index:1,name:"Err"}]}},params:[{name:"T",type:10},{name:"E",type:8}],path:["Result"]}},{id:10,type:{def:{variant:{variants:[{fields:[{type:7}],index:0,name:"Ok"},{fields:[{type:11}],index:1,name:"Err"}]}},params:[{name:"T",type:7},{name:"E",type:11}],path:["Result"]}},{id:11,type:{def:{variant:{variants:[{index:0,name:"NotAdmin"},{index:1,name:"InvalidRegistryAddress"},{fields:[{type:5,typeName:"String"}],index:2,name:"TldAlreadyInUse"},{fields:[{type:5,typeName:"String"}],index:3,name:"TldNotFound"},{index:4,name:"CouldNotResolveDomain"},{index:5,name:"InvalidDomainName"},{index:6,name:"EmptyList"}]}},path:["azns_router","azns_router","Error"]}},{id:12,type:{def:{variant:{variants:[{fields:[{type:13}],index:0,name:"Ok"},{fields:[{type:8}],index:1,name:"Err"}]}},params:[{name:"T",type:13},{name:"E",type:8}],path:["Result"]}},{id:13,type:{def:{sequence:{type:14}}}},{id:14,type:{def:{tuple:[0,4]}}},{id:15,type:{def:{variant:{variants:[{fields:[{type:4}],index:0,name:"Ok"},{fields:[{type:8}],index:1,name:"Err"}]}},params:[{name:"T",type:4},{name:"E",type:8}],path:["Result"]}},{id:16,type:{def:{variant:{variants:[{fields:[{type:17}],index:0,name:"Ok"},{fields:[{type:8}],index:1,name:"Err"}]}},params:[{name:"T",type:17},{name:"E",type:8}],path:["Result"]}},{id:17,type:{def:{variant:{variants:[{index:0,name:"None"},{fields:[{type:0}],index:1,name:"Some"}]}},params:[{name:"T",type:0}],path:["Option"]}},{id:18,type:{def:{variant:{variants:[{fields:[{type:19}],index:0,name:"Ok"},{fields:[{type:8}],index:1,name:"Err"}]}},params:[{name:"T",type:19},{name:"E",type:8}],path:["Result"]}},{id:19,type:{def:{variant:{variants:[{fields:[{type:0}],index:0,name:"Ok"},{fields:[{type:11}],index:1,name:"Err"}]}},params:[{name:"T",type:0},{name:"E",type:11}],path:["Result"]}},{id:20,type:{def:{variant:{variants:[{index:0,name:"None"},{fields:[{type:5}],index:1,name:"Some"}]}},params:[{name:"T",type:5}],path:["Option"]}},{id:21,type:{def:{variant:{variants:[{fields:[{type:22}],index:0,name:"Ok"},{fields:[{type:8}],index:1,name:"Err"}]}},params:[{name:"T",type:22},{name:"E",type:8}],path:["Result"]}},{id:22,type:{def:{sequence:{type:23}}}},{id:23,type:{def:{tuple:[0,5]}}},{id:24,type:{def:{variant:{variants:[{fields:[{type:0}],index:0,name:"Ok"},{fields:[{type:8}],index:1,name:"Err"}]}},params:[{name:"T",type:0},{name:"E",type:8}],path:["Result"]}},{id:25,type:{def:{primitive:"u128"}}},{id:26,type:{def:{composite:{fields:[{type:1,typeName:"[u8; 32]"}]}},path:["ink_primitives","types","Hash"]}},{id:27,type:{def:{primitive:"u64"}}},{id:28,type:{def:{primitive:"u32"}}},{id:29,type:{def:{variant:{}},path:["ink_env","types","NoChainExtension"]}}],version:"4"}});var Re={};le(Re,{CONTRACT_ADDRESSES:()=>U,ContractId:()=>C,ResolveAddressError:()=>y,ResolveDomainError:()=>u,SupportedChainId:()=>R,SupportedTLD:()=>M,alephzero:()=>J,alephzeroTestnet:()=>G,allChains:()=>z,allSupportedChainIds:()=>c,development:()=>q,getContract:()=>L,getContractAbi:()=>Q,getContractAddress:()=>O,getSupportedTLDs:()=>$,resolveAddressToDomain:()=>fe,resolveDomainToAddress:()=>ge,sanitizeDomain:()=>V});module.exports=me(Re);var R=(r=>(r.AlephZero="alephzero",r.AlephZeroTestnet="alephzero-testnet",r.Development="development",r))(R||{}),c=Object.values(R),J={network:"alephzero",name:"Aleph Zero",ss58Prefix:42,rpcUrls:["wss://ws.azero.dev"]},G={network:"alephzero-testnet",name:"Aleph Zero Testnet",ss58Prefix:42,rpcUrls:["wss://ws.test.azero.dev"],testnet:!0},q={network:"development",name:"Local Development",ss58Prefix:42,rpcUrls:["ws://127.0.0.1:9944"],testnet:!0},z=[J,G,q],M=(r=>(r.AZERO="azero",r.A0="a0",r.TZERO="tzero",r))(M||{}),C=(s=>(s.Router="azns_router",s.Registry="azns_registry",s.FeeCalculator="azns_fee_calculator",s.MerkleVerifier="azns_merkle_verifier",s.NameChecker="azns_name_checker",s))(C||{}),U={alephzero:{azns_router:"5FfRtDtpS3Vcr7BTChjPiQNrcAKu3VLv4E1NGF6ng6j3ZopJ"},"alephzero-testnet":{azns_router:"5HXjj3xhtRMqRYCRaXTDcVPz3Mez2XBruyujw6UEkvn8PCiA"}};var K=require("@polkadot/api-contract"),X=A(require("loglevel"));var $=e=>({alephzero:["azero","a0"],"alephzero-testnet":["tzero"]})[e]||[],Q=async e=>await{azns_router:Promise.resolve().then(()=>A(F()))}[e],O=(e,a,t)=>t?.[a]??U[e]?.[a],L=async(e,a,t,r)=>{let n=await Q(t);if(!n)throw new Error(`No metadata found for contract '${t}'.`);let s=O(a,t,r);if(!s)throw new Error(`No address found for contract '${t}' on chain '${a}'.`);let p=new K.ContractPromise(e,n,s);return X.default.debug(`Initialized contract '${t}' at address '${s}'`),{abi:n,address:s,contract:p}};var I=require("@polkadot/util"),b=require("@polkadot/util-crypto"),v=A(require("loglevel"));var h=class extends Error{name;message;cause;constructor({name:a,message:t,cause:r}){super(),this.name=a,this.message=t,this.cause=r}};var Z=require("@polkadot/util"),Y=(e,a)=>{let t=e.abi.messages.find(r=>(0,Z.stringCamelCase)(r.method)===(0,Z.stringCamelCase)(a));if(!t)throw new Error(`"${a}" not found in Contract`);return t};function ee(e){return typeof e=="object"&&e!==null&&"Err"in e}function te(e){return typeof e=="object"&&e!==null&&"Ok"in e}function ce(e){return e?.lookupName||e?.type||""}function N({result:e},a,t){let r,n="",s=!0;if(e.isOk){s=e.asOk.flags.toHuman().includes("Revert");let l=Y(a,t).returnType,f=ce(l),g=a.abi.registry,i=l?g.createTypeUnsafe(f,[e.asOk.data]).toHuman():"()";r=te(i)?i.Ok:ee(i)?i.Err:i;let m=ee(r)?typeof r.Err=="object"?JSON.stringify(r.Err,null,2):r.Err?.toString()??"Error":r!=="Ok"&&r?.toString()||"Error",o=te(i)?typeof r=="object"?JSON.stringify(r,null,"	"):r?.toString()??"()":JSON.stringify(r,null,"	")??"()";n=s?m:o}return{output:r,decodedOutput:n,isError:s}}var x=require("@polkadot/api"),ae=A(require("loglevel"));var j,re,k=async(e,a)=>{if(j&&re?.network===e)return j;let t=z.find(p=>p.network===e),r=t?.rpcUrls?.[0];if(!t||!r)throw new Error(`Given chain '${e}' not supported.`);let n=r.startsWith("http")?new x.HttpProvider(r):new x.WsProvider(r),s=await x.ApiPromise.create({provider:n,noInitWarn:!0,...a});return await s.isReadyOrError,ae.default.debug(`Initialized API for chain '${e}'`),j=s,re=t,s};var d=require("@polkadot/util"),ye=(e,a,t)=>{let r=(0,d.bnToBn)(a),n=(0,d.bnToBn)(t);return e.registry.createType("WeightV2",{refTime:r,proofSize:n})},D=(e,a=.8)=>{let r=e.consts.system.blockWeights.toPrimitive()?.perClass?.normal?.maxExtrinsic,n=r?.refTime?(0,d.bnToBn)(r.refTime).mul(new d.BN(a*100)).div(new d.BN(100)):new d.BN(0),s=r?.proofSize?(0,d.bnToBn)(r.proofSize).mul(new d.BN(a*100)).div(new d.BN(100)):new d.BN(0);return ye(e,n,s)};var w,B,S=async(e,a,t)=>{let r=O(a,"azns_router",t);if(w&&B&&r===B)return w;let{contract:n}=await L(e,a,"azns_router",t);return w=n,B=r,w};var y=class extends h{},fe=async(e,a)=>{try{let t=Object.assign({chainId:"alephzero"},a);if(v.default.setLevel(t.debug?"DEBUG":"WARN"),!c.includes(t.chainId))return{primaryDomain:void 0,allPrimaryDomains:void 0,error:new y({name:"UNSUPPORTED_NETWORK",message:`Unsupported chainId '${t.chainId}' (must be one of: ${c.join(", ")})`})};let r=t?.customApi||await k(t.chainId),n=await S(r,t.chainId,t.customContractAddresses),s=(e||"").trim(),p=r.registry.chainSS58||42;try{if(t.ignoreAddressPrefix)s=(0,b.encodeAddress)((0,I.isHex)(e)?(0,I.hexToU8a)(e):(0,b.decodeAddress)(e),p);else if(!(0,b.checkAddress)(s,p)[0])throw new Error}catch{return{primaryDomain:void 0,allPrimaryDomains:void 0,error:new y({name:"INVALID_ADDRESS_FORMAT",message:"Address must have valid SS58 format"})}}let P=await n.query.getPrimaryDomains("",{gasLimit:D(r)},s,null),l=[],{output:f,isError:g,decodedOutput:i}=N(P,n,"get_primary_domains");if(g){let o=i?`Contract error while resolving address '${s}': ${i}`:`Contract failed while resolving address '${s}' without error message`;return v.default.error(o),{primaryDomain:void 0,allPrimaryDomains:void 0,error:new y({name:"CONTRACT_ERROR",message:o,cause:i})}}else g||(l=(f||[]).map(([,o])=>o));let m=l?.length?l[0]:null;return v.default.debug(m?`Resolved primary domain for address '${s}': ${m}`:`No primary domain found for address '${s}'`),{primaryDomain:m,allPrimaryDomains:l,error:void 0}}catch(t){return v.default.debug(`Error while resolving address '${e}':`,t),{primaryDomain:void 0,allPrimaryDomains:void 0,error:new y({name:"OTHER_ERROR",message:t?.message||"Unexpected error while resolving address",cause:t})}}};var E=A(require("loglevel"));var V=(e,a)=>{if(!e||typeof e!="string")return"";let t=Object.assign({trim:!0,lowercase:!0},a),r=e;return t.trim&&(r=r.trim()),t.lowercase&&(r=r.toLowerCase()),t.replaceUnderscores&&(r=r.replaceAll("_","-")),t.removeOuterNonAlphanumeric&&(r=r=r.replace(/^[^a-z0-9]+|[^a-z0-9]+$/g,"")),r};var u=class extends h{},ge=async(e,a)=>{try{let t=Object.assign({chainId:"alephzero"},a);if(E.default.setLevel(t.debug?"DEBUG":"WARN"),!c.includes(t.chainId))return{address:void 0,error:new u({name:"UNSUPPORTED_NETWORK",message:`Unsupported chainId '${t.chainId}' (must be one of: ${c.join(", ")})`})};let r=t.skipSanitization?e:V(e),s=new RegExp("^(?:([^.]+)\\.)([^.]+)$").exec(r);if(!s||s.length!==3)return{address:void 0,error:new u({name:"INVALID_DOMAIN_FORMAT",message:"Domain must be in format 'name.tld'"})};let[,,p]=s;if(!$(t.chainId).includes(p)&&t.chainId!=="development")return{address:void 0,error:new u({name:"UNSUPPORTED_TLD",message:`Unsupported TLD '${p}' on '${t.chainId}'`})};let l=t?.customApi||await k(t.chainId),f=await S(l,t.chainId,t.customContractAddresses),g=await f.query.getAddress("",{gasLimit:D(l)},r),{output:i,isError:m,decodedOutput:o}=N(g,f,"get_address"),T=null;if(m&&o!=="CouldNotResolveDomain"){let W=o?`Contract error while resolving domain '${r}': ${o}`:`Contract failed while resolving domain '${r}' without error message`;return E.default.error(W),{address:void 0,error:new u({name:"CONTRACT_ERROR",message:W,cause:o})}}else m||(T=i.Ok);return E.default.debug(T?`Resolved address for domain '${r}': ${T}`:`Domain '${r}' not found`),{address:T,error:void 0}}catch(t){return E.default.debug(`Error while resolving domain '${e}':`,t),{address:void 0,error:new u({name:"OTHER_ERROR",message:t?.message||"Unexpected error while resolving domain",cause:t})}}};0&&(module.exports={CONTRACT_ADDRESSES,ContractId,ResolveAddressError,ResolveDomainError,SupportedChainId,SupportedTLD,alephzero,alephzeroTestnet,allChains,allSupportedChainIds,development,getContract,getContractAbi,getContractAddress,getSupportedTLDs,resolveAddressToDomain,resolveDomainToAddress,sanitizeDomain});
//# sourceMappingURL=index.js.map